<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ROLETA IAP VANGUARDA ‚ö°</title>

<link rel="manifest" href="manifest.webmanifest">


<style>
/* ================== REFORMULA√á√ÉO VISUAL E FONTES ================== */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;800&family=Roboto+Mono:wght@400;700&display=swap');

:root{
  --bg:#0c011a; /* Roxo Escuro */
  --panel:#1a0830; /* Fundo do Card */
  --accent:#00ffae; /* Verde Neon */
  --muted:#a0a4b8;
  --zero:#ffc400; /* Amarelo Dourado */
  --red:#ff3b57; /* Vermelho Agressivo */
  --black:#020202; 
  --btn-main:linear-gradient(90deg,#00ffae,#00aeff); 
  --alert-red:#ff3b57; /* Para Stop Loss */
  --alert-green:#00ffae; /* Para Stop Win */
  --lock-bg:rgba(26,8,48,0.95);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Roboto Mono',monospace; /* Fonte de Console para dados */
  background:var(--bg);
  color:#e8f0ff;
  padding:14px;
}
.hidden { display: none !important; }

/* ================== LAYOUT E COMPONENTES B√ÅSICOS ================== */

/* Header / clock */
.header{
  background: linear-gradient(90deg, rgba(0,255,174,0.08), rgba(255,0,255,0.04)); 
  border-radius:12px; 
  padding:12px; 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  box-shadow:0 0 20px rgba(0,255,174,0.1);
}
.title{
  font-family:'Orbitron',sans-serif;
  font-weight:800;
  font-size:18px;
  color: var(--accent);
}
#clock{
  color:var(--zero); /* Destaque Amarelo */
  font-family:'Orbitron',sans-serif;
  font-weight:700;
  text-shadow:0 0 10px rgba(255,196,0,0.6);
}

/* card */
.card{
  background:var(--panel);
  border-radius:12px;
  padding:12px;
  margin-top:12px;
  box-shadow:0 8px 40px rgba(0,0,0,0.6);
  border:1px solid rgba(0,255,174,0.1); /* Borda sutil de neon */
}

/* T√≠tulos / Sugest√µes */
.suggestionTitle{
  font-family:'Orbitron',sans-serif;
  font-weight:800;
  color:var(--accent); /* T√≠tulos em Verde Neon */
  margin-bottom:6px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.suggestionBox{
  font-size:14px;
  color:#dff;
  line-height:1.6;
}
.iaGlow{
  color:var(--zero); /* Booster em Amarelo */
  text-shadow:0 0 18px rgba(255,196,0,0.4);
  animation:glowPulse 2s infinite alternate;
  font-family:'Orbitron',sans-serif;
  font-weight:700;
}
@keyframes glowPulse{
  0%{text-shadow:0 0 6px rgba(255,196,0,0.2)}
  100%{text-shadow:0 0 18px rgba(255,196,0,0.8)}
}

.data-separator {
  height: 1px;
  background: linear-gradient(90deg, var(--accent), rgba(0,0,0,0));
  margin: 10px 0;
  opacity: 0.3;
}

/* ================== BOT√ïES E INPUTS ================== */

/* grid numbers */
.grid{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  justify-content:center;
  margin-top: 10px;
}
.number-btn{
  width:46px;height:46px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,0.1);
  font-family:'Orbitron',sans-serif;
  font-weight:700;
  cursor:pointer;
  transition:transform .14s,box-shadow .14s;
}
.number-btn:hover{transform:scale(1.05); box-shadow:0 0 15px rgba(0,255,174,0.3);}
.red{background:var(--red);color:#fff}
.black{background:var(--black);color:#fff}
.zero, .green {background:var(--zero);color:var(--bg)} 

/* Bot√µes de controle */
.control-btn{
  background:var(--btn-main);
  border:0;
  border-radius:8px;
  padding:10px 14px;
  color:var(--bg); 
  font-weight:800;
  font-family:'Orbitron',sans-serif;
  cursor:pointer;
  transition: all .2s;
  margin: 4px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}
.control-btn:hover{opacity:0.9; box-shadow: 0 0 15px rgba(0,255,174,0.6);}
.control-btn:active{transform: translateY(1px);}
.control-btn:disabled { 
    opacity: 0.4; 
    cursor: not-allowed; 
    box-shadow: none; 
}


.btn-win { background: var(--alert-green); color: var(--bg); }
.btn-loss { background: var(--alert-red); color: #fff; }

/* history chips */
.chip{
  /* Estilos... */
}

/* ================== TELA DE BLOQUEIO (CADEADO) ================== */

#lockScreen{
  position:fixed;
  inset:0;
  background:var(--lock-bg);
  backdrop-filter: blur(4px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:9000;
  text-align:center;
}
#lockScreen h2{
  font-family:'Orbitron',sans-serif;
  color:var(--alert-red);
  font-size:24px;
}
#lockScreen h2.win {
  color:var(--alert-green);
}
#lockScreen p{
  font-size:18px;
  color:var(--muted);
  margin-top: 10px;
}
#lockScreen .countdown{
  font-family:'Orbitron',sans-serif;
  font-size:36px;
  font-weight:800;
  color:var(--accent);
  margin-top:15px;
  text-shadow: 0 0 20px rgba(0,255,174,0.6);
}
</style>
</head>
<body>

<div id="lockScreen" class="hidden">
  <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" viewBox="0 0 16 16" id="lockIcon">
    <path d="M8 1a2 2 0 0 0-2 2v4h4V3a2 2 0 0 0-2-2m3 6V3a3 3 0 1 0-6 0v4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1zM4 8a.5.5 0 0 0-.5.5v5a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5v-5a.5.5 0 0 0-.5-.5z"/>
  </svg>
  <h2 id="lockTitle">ZONA SEGURA ATINGIDA (STOP LOSS)</h2>
  <p>An√°lise bloqueada. Retorne ap√≥s o per√≠odo de resfriamento:</p>
  <div class="countdown" id="countdownTimer">02:00:00</div>
</div>


<div id="loginScreen"> 
  <div id="loginBox">
    <div class="login-title">ROLETA IAP VANGUARDA ‚ö°</div>
    <div class="login-subtitle">An√°lise de Sucess√£o de Zonas</div>

    <div id="signInForm">
      <input id="authPwd" type="password" placeholder="Senha de Acesso" autocomplete="current-password" required><br>
      
      <div style="display:flex; gap:10px; margin-top:15px;">
          <button id="btnSignInReal" class="control-btn" style="flex:1; background: linear-gradient(90deg, #ffc400, #ff8c00); color: var(--bg);">MODO REAL</button>
          <button id="btnSignInDemo" class="control-btn" style="flex:1; background: var(--btn-main); color: var(--bg);">MODO DEMO</button>
      </div>
      
    </div>
    
  </div>
</div>

<div id="mainPanel" class="hidden">
  <div class="header">
    <div class="title">ROLETA IAP <span id="modeDisplay">REAL</span> ‚ö°</div>
    <div id="clock">--:--:--</div>
  </div>

  <div class="card">
    <div class="suggestionTitle">üî¢ INSER√á√ÉO R√ÅPIDA DE RESULTADOS</div>
    <div class="grid" id="gridNumbers"></div>
    <div class="data-separator"></div>
    <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-top:12px;">
        <button id="btnUpload" class="control-btn" style="flex:1 1 150px;">üì∑ UPLOAD (OCR)</button> 
        <button id="clearBtn" class="control-btn btn-loss" title="Limpar hist√≥rico" style="flex:1 1 100px;">LIMPAR HIST√ìRICO</button>
        <button id="logoutBtn" class="control-btn control-logout" title="Sair" style="flex:1 1 100px;">SAIR</button>
    </div>
  </div>
  
  <div class="card" id="boosterCard">
    <div class="suggestionTitle iaGlow">‚≠ê SUGEST√ÉO DE ZONA I.A. (BOOSTER)</div>
    <div id="betSuggestion" class="suggestionBox" style="font-size: 16px; font-weight: 700;">
        <span style="color:var(--muted)">Aguardando dados ou aguardando desbloqueio...</span>
    </div>
  </div>
  
  <div class="card">
    <div class="analysis-wrapper">
      <div class="analysis-main">
        <div class="suggestionTitle">üöÄ AN√ÅLISE DE SUCESS√ÉO DE ZONAS (TOP 3)</div>
        <div id="zoneAnalysis" class="suggestionBox">Adicione n√∫meros ao hist√≥rico para an√°lise de Zonas.</div>
      </div>
      <div class="analysis-hot-cold" style="margin-top:10px;">
        <div class="suggestionTitle">üî• TEND√äNCIAS GERAIS</div>
        <div id="hotCold" class="suggestionBox">üî• Hot: -<br>‚ùÑÔ∏è Cold: -</div>
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="suggestionTitle">üí∏ GEST√ÉO DE BANCA E RISCO</div>
    <div id="performanceDashboard" class="dashboard-grid">
      <span class="stat-title" style="grid-column: 1 / -1;">Defina sua banca inicial para come√ßar.</span>
    </div>
    
    <div class="data-separator"></div>
    
    <div class="bankroll-grid">
        <div>
            <div class="bankroll-label">BANCA INICIAL (R$)</div>
            <input id="initialBankrollInput" type="number" class="bankroll-input" placeholder="1000" min="0" step="0.01">
            <button id="btnSetBankroll" class="control-btn" style="width: 100%; margin-top: 8px;">DEFINIR</button>
        </div>
        <div class="bankroll-actions">
            <div class="bankroll-label">REGISTRAR ENTRADA (R$)</div>
            <input id="betAmountInput" type="number" class="bankroll-input" placeholder="Valor ganho/perdido" min="0" step="0.01">
            <button id="btnRegisterWin" class="control-btn btn-win" style="margin-top: 8px;">LUCRAR (+)</button>
            <button id="btnRegisterLoss" class="control-btn btn-loss">RED (-)</button>
        </div>
    </div>
  </div>
  
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="history-title">HIST√ìRICO DA ROLETA <span id="historyCount" class="history-subtitle">0/100</span></div>
      <div class="history-subtitle">Recentes ‚Üí Antigos</div> 
    </div>
    <div id="history" class="history"></div>
    
    <div class="data-separator"></div>
    
    <div class="suggestionTitle">üßæ EXTRATO DE TRANSA√á√ïES</div>
    <div id="bankrollHistory" class="bankroll-history-list">
      <div class="log-item log-placeholder">Nenhum registro ainda.</div>
    </div>
  </div>

  <input type="file" id="uploadPhoto" accept="image/*" class="hidden">
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ================== CONSTANTES DE CONFIGURA√á√ÉO ================== */
  const getPasswordHash = () => '2025'; 
  const BANKROLL_STORAGE_KEY = 'roletaIAPBankroll_main';
  const HISTORY_STORAGE_KEY = 'roletaIAPHistory'; 
  const CONFIG_STORAGE_KEY = 'roletaIAPConfig'; 
  
  // Ordem circular da roleta (padr√£o europeu)
  const WHEEL_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
  const WHEEL_INDEX_MAP = {};
  WHEEL_ORDER.forEach((num, index) => { WHEEL_INDEX_MAP[num] = index; });

  const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36]);
  
  // Constantes de Stop Loss/Win
  const STOP_LOSS_COUNT = 2; // 2 REDs consecutivos
  const STOP_LOSS_AMOUNT = 35.00; // R$35,00 de preju√≠zo total
  const STOP_WIN_COUNT = 3; // 3 WINs consecutivos
  const STOP_WIN_AMOUNT = 35.00; // R$35,00 de lucro total
  const LOCK_DURATION = 2 * 60 * 60 * 1000; // 2 horas em milissegundos
  
  /* ================== ELEMENTOS DOM ================== */
  const loginScreen = document.getElementById('loginScreen');
  const mainPanel = document.getElementById('mainPanel');
  const modeDisplay = document.getElementById('modeDisplay');
  const lockScreen = document.getElementById('lockScreen');
  const lockTitle = document.getElementById('lockTitle');
  const countdownTimer = document.getElementById('countdownTimer');
  const boosterCard = document.getElementById('boosterCard');
  
  const historyDiv = document.getElementById('history');
  const historyCount = document.getElementById('historyCount');
  const zoneAnalysisDiv = document.getElementById('zoneAnalysis');
  const hotColdDiv = document.getElementById('hotCold');
  const betSuggestionDiv = document.getElementById('betSuggestion');
  const gridNumbers = document.getElementById('gridNumbers');

  const btnRegisterWin = document.getElementById('btnRegisterWin');
  const btnRegisterLoss = document.getElementById('btnRegisterLoss');
  const betAmountInput = document.getElementById('betAmountInput');
  const initialBankrollInput = document.getElementById('initialBankrollInput');
  const bankrollHistoryDiv = document.getElementById('bankrollHistory');
  const authPwdInput = document.getElementById('authPwd');
  const btnUpload = document.getElementById('btnUpload'); 
  
  /* ================== ESTADO DA APLICA√á√ÉO ================== */
  let historyArr = []; 
  let numberStats = {}; 
  let config = {
      mode: 'DEMO', // 'DEMO' ou 'REAL'
      isLocked: false,
      lockUntil: 0,
  };
  
  let bankrollState = {
    initial: 0,
    current: 0,
    history: [] 
  };
  const MAX_HISTORY = 100;
  const HOT_THRESHOLD = 3; 
  
  /* ================== UTILIT√ÅRIOS ================== */
  const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2, maximumFractionDigits: 2 });
  function getColor(num) {
    if (num === 0) return 'zero';
    if (RED_NUMBERS.has(num)) return 'red';
    return 'black';
  }
  
  // Calcula vizinhos em uma ordem circular (baseado em WHEEL_ORDER)
  function getNeighbors(centerNum, radius) {
    const centerIndex = WHEEL_INDEX_MAP[centerNum];
    const neighbors = [];
    const len = WHEEL_ORDER.length;

    for (let i = -radius; i <= radius; i++) {
        const index = (centerIndex + i + len) % len;
        neighbors.push(WHEEL_ORDER[index]);
    }
    return neighbors.sort((a, b) => a - b);
  }
  
  /* ================== PERSIST√äNCIA E SESS√ÉO ================== */
  
  function saveConfig() {
    localStorage.setItem(CONFIG_STORAGE_KEY, JSON.stringify(config));
  }
  function loadConfig() {
    const savedConfig = localStorage.getItem(CONFIG_STORAGE_KEY);
    if (savedConfig) {
      config = JSON.parse(savedConfig);
    }
    // For√ßa a atualiza√ß√£o do modo no display
    modeDisplay.textContent = config.mode;
  }

  function saveBankrollData() {
    localStorage.setItem(BANKROLL_STORAGE_KEY, JSON.stringify(bankrollState));
  }
  function loadBankrollData() {
    const savedData = localStorage.getItem(BANKROLL_STORAGE_KEY);
    if (savedData) {
      bankrollState = JSON.parse(savedData);
      bankrollState.initial = bankrollState.initial || 0;
      bankrollState.current = bankrollState.current || 0;
      bankrollState.history = bankrollState.history || [];
    } else {
      bankrollState = { initial: 0, current: 0, history: [] };
    }
    initialBankrollInput.value = bankrollState.initial > 0 ? bankrollState.initial : '';
  }

  function saveHistoryData() {
    localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(historyArr));
  }
  function loadHistoryData() {
    const savedHistory = localStorage.getItem(HISTORY_STORAGE_KEY);
    if (savedHistory) {
      historyArr = JSON.parse(savedHistory).map(Number);
    } else {
      historyArr = [];
    }
  }
  
  function setLoginStatus(isLoggedIn, mode = 'DEMO') {
      if (isLoggedIn) {
          localStorage.setItem('isLoggedIn_roletaIAP', 'true');
          config.mode = mode;
          saveConfig();
      } else {
          localStorage.removeItem('isLoggedIn_roletaIAP');
      }
  }

  function getLoginStatus() {
      return localStorage.getItem('isLoggedIn_roletaIAP') === 'true'; 
  }
  
  /* ================== L√ìGICA DE BLOQUEIO / STOP ================== */

  let countdownInterval;

  function checkLockStatus() {
      const now = Date.now();
      
      if (config.isLocked && config.lockUntil > now) {
          lockScreen.classList.remove('hidden');
          mainPanel.classList.add('hidden');
          startCountdown();
          return true;
      }

      if (config.isLocked && config.lockUntil <= now) {
          // Desbloqueia
          config.isLocked = false;
          config.lockUntil = 0;
          saveConfig();
      }
      
      lockScreen.classList.add('hidden');
      if(getLoginStatus()) mainPanel.classList.remove('hidden');
      stopCountdown();
      return false;
  }
  
  function startCountdown() {
      stopCountdown(); // Garante que apenas um contador est√° rodando
      
      countdownInterval = setInterval(() => {
          const remainingTime = config.lockUntil - Date.now();
          if (remainingTime <= 0) {
              checkLockStatus(); // Deve desbloquear e parar o contador
              return;
          }

          const totalSeconds = Math.floor(remainingTime / 1000);
          const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
          const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
          const seconds = String(totalSeconds % 60).padStart(2, '0');
          
          countdownTimer.textContent = `${hours}:${minutes}:${seconds}`;

      }, 1000);
  }

  function stopCountdown() {
      if (countdownInterval) {
          clearInterval(countdownInterval);
      }
  }
  
  function triggerLock(reason) {
      if (config.mode !== 'REAL') return;

      config.isLocked = true;
      config.lockUntil = Date.now() + LOCK_DURATION;
      saveConfig();
      
      lockScreen.classList.remove('hidden');
      mainPanel.classList.add('hidden');
      
      if (reason === 'STOP_LOSS') {
          lockTitle.textContent = 'ZONA SEGURA ATINGIDA (STOP LOSS)';
          lockTitle.classList.remove('win');
      } else if (reason === 'STOP_WIN') {
          lockTitle.textContent = 'ZONA SEGURA ATINGIDA (STOP WIN)';
          lockTitle.classList.add('win');
      }
      
      checkLockStatus();
  }

  function checkStopCondition() {
      if (config.mode !== 'REAL') return;

      const { current, initial, history } = bankrollState;
      const totalProfit = parseFloat((current - initial).toFixed(2));
      
      // 1. Verifica√ß√£o de Saldo (STOP LOSS/WIN AMOUNT)
      if (totalProfit <= -STOP_LOSS_AMOUNT) {
          triggerLock('STOP_LOSS');
          return;
      }
      if (totalProfit >= STOP_WIN_AMOUNT) {
          triggerLock('STOP_WIN');
          return;
      }
      
      // 2. Verifica√ß√£o de Sequ√™ncia (REDs/WINs Consecutivos)
      const last3 = history.slice(-3);
      let consecutiveLoss = 0;
      let consecutiveWin = 0;
      
      // Itera de tr√°s para frente
      for (let i = history.length - 1; i >= 0; i--) {
          const amount = history[i].amount;
          if (amount < 0) {
              consecutiveLoss++;
              consecutiveWin = 0; 
          } else if (amount > 0) {
              consecutiveWin++;
              consecutiveLoss = 0; 
          } else {
              break; // Para em registros de 0.00
          }
          
          if (consecutiveLoss >= STOP_LOSS_COUNT) {
              triggerLock('STOP_LOSS');
              return;
          }
          if (consecutiveWin >= STOP_WIN_COUNT) {
              triggerLock('STOP_WIN');
              return;
          }
      }
  }

  /* ================== L√ìGICA DE GEST√ÉO DE BANCA ================== */
  
  function registerTransaction(amount, isWin) {
    if (config.mode === 'DEMO' && config.bankrollState?.initial === 0) {
        alert('O registro de entradas s√≥ √© liberado no Modo Real ou ap√≥s definir a Banca Inicial no Demo.');
        return;
    }
    
    const finalAmount = parseFloat(parseFloat(amount).toFixed(2));
    if (isNaN(finalAmount) || finalAmount <= 0) {
        alert('Por favor, insira um valor v√°lido.');
        return;
    }
    
    bankrollState.current = (bankrollState.current * 100 + (isWin ? finalAmount : -finalAmount) * 100) / 100;
    bankrollState.history.push({ amount: isWin ? finalAmount : -finalAmount, timestamp: Date.now() });
    
    saveBankrollData();
    checkStopCondition();
    updateUI();
    betAmountInput.value = '';
  }

  document.getElementById('btnSetBankroll').onclick = () => {
    // ... L√≥gica de Set Bankroll (Permitida em REAL e DEMO)
    const initialRaw = parseFloat(initialBankrollInput.value);
    const initial = parseFloat(initialRaw.toFixed(2)); 

    if (isNaN(initial) || initial <= 0) {
      alert('Por favor, insira um valor de banca inicial v√°lido.');
      return;
    }
    
    if (bankrollState.initial > 0 && 
        !confirm('Ao redefinir a banca, o hist√≥rico de lucro/perda ser√° zerado. Continuar?')) {
        return;
    }

    bankrollState.initial = initial;
    bankrollState.current = initial;
    bankrollState.history = [];
    
    saveBankrollData();
    updateUI();
    alert(`Banca inicial definida em ${formatCurrency(initial)}`);
  };
  
  btnRegisterWin.onclick = () => registerTransaction(betAmountInput.value, true);
  btnRegisterLoss.onclick = () => registerTransaction(betAmountInput.value, false);
  
  /* ================== L√ìGICA DE AN√ÅLISE DE ZONAS ================== */

  function calculateStats() {
    const allNumbers = [...Array(37).keys()]; 
    const stats = {
      counts: {},
      zoneSuccessionMap: {}, // Nova estrutura: { lastZoneCenter: [nextZoneCenter, nextZoneCenter, ...], ... }
      hotList: [],
      coldList: [],
    };
    allNumbers.forEach(n => { stats.counts[n] = { count: 0 }; });

    // 1. Mapeamento de Frequ√™ncia e Sucess√£o de Zonas
    for (let i = historyArr.length - 1; i >= 0; i--) {
      const num = historyArr[i];
      stats.counts[num].count++;
      
      if (i > 0) {
        const lastNum = historyArr[i]; 
        const currentNum = historyArr[i - 1]; 
        
        // Define a Zona de Ocorr√™ncia (Centro: lastNum, Raio: 2)
        const lastZone = getNeighbors(lastNum, 2).sort().join(','); // Ex: 4, 5, 6, 7, 8
        const currentZoneCenter = currentNum; // O pr√≥ximo n√∫mero ser√° o centro da Zona de Sucess√£o
        
        if (!stats.zoneSuccessionMap[lastZone]) {
          stats.zoneSuccessionMap[lastZone] = [];
        }
        stats.zoneSuccessionMap[lastZone].push(currentZoneCenter);
      }
    }
    
    // 2. Hot/Cold (Padr√£o Antigo Mantido para An√°lise Geral)
    const allCounts = allNumbers.map(n => stats.counts[n].count);
    const minCount = allCounts.length > 0 ? Math.min(...allCounts) : 0;
    
    stats.hotList = allNumbers
      .filter(n => stats.counts[n].count > 0)
      .sort((a, b) => stats.counts[b].count - stats.counts[a].count)
      .slice(0, 4);
    
    stats.coldList = allNumbers
      .filter(n => stats.counts[n].count === minCount) 
      .sort((a, b) => a - b) 
      .slice(0, 4);

    numberStats = stats;
  }
  
  function addNumber(num) {
    if (historyArr.length >= MAX_HISTORY) {
      historyArr.pop(); 
    }
    historyArr.unshift(num); 
    saveHistoryData();
    updateUI();
  }
  
  /* ================== RENDERIZA√á√ÉO DA UI E BOOSTER ================== */
  
  function updateUI() {
    if(getLoginStatus() && !checkLockStatus()) {
        mainPanel.classList.remove('hidden');
    } else if (!getLoginStatus()) {
        loginScreen.classList.remove('hidden');
        return;
    }
    
    calculateStats();
    renderControls(); // Habilita/Desabilita bot√µes
    renderHistory();
    renderHotCold();
    renderZoneAnalysis();
    renderBetSuggestion();
    // ... Outras renderiza√ß√µes (dashboard, history count)
    
    historyCount.textContent = `${historyArr.length}/${MAX_HISTORY}`;
  }

  function renderControls() {
      const isDisabled = config.mode === 'DEMO';
      
      // Habilita/Desabilita bot√µes de Transa√ß√£o (Win/Loss)
      btnRegisterWin.disabled = isDisabled;
      btnRegisterLoss.disabled = isDisabled;

      // Habilita/Desabilita Sugest√£o (Booster)
      boosterCard.style.opacity = isDisabled ? '0.5' : '1';
      
      // Habilita/Desabilita bot√µes de N√∫mero
      document.querySelectorAll('.number-btn').forEach(btn => {
          btn.disabled = false; // A entrada de n√∫meros √© sempre permitida para an√°lise
      });
  }

  function renderZoneAnalysis() {
    if (historyArr.length < 5) { // Precisa de hist√≥rico m√≠nimo para ser relevante
      zoneAnalysisDiv.innerHTML = 'Adicione pelo menos 5 lan√ßamentos para come√ßar a an√°lise de Sucess√£o de Zonas.';
      return;
    }
    
    const lastNum = historyArr[0];
    const lastZone = getNeighbors(lastNum, 2).sort().join(','); // Zona de Ocorr√™ncia Atual
    const followers = numberStats.zoneSuccessionMap[lastZone];
    
    if (!followers || followers.length < 5) {
      zoneAnalysisDiv.innerHTML = `O √∫ltimo n√∫mero foi **${lastNum}** (Zona: ${getNeighbors(lastNum, 2).join(', ')}). Necess√°rio mais ocorr√™ncias desta Zona para gerar dados de sucess√£o confi√°veis.`;
      return;
    }
    
    // Contagem dos Centros de Zonas Sucessoras
    const followerCounts = {};
    for (const num of followers) {
      followerCounts[num] = (followerCounts[num] || 0) + 1;
    }
    
    const sortedFollowers = Object.entries(followerCounts)
      .sort((a, b) => b[1] - a[1]);

    let html = `<div style="margin-bottom: 6px;">Ap√≥s a **Zona de Ocorr√™ncia** (${getNeighbors(lastNum, 2).join(', ')}), as Zonas de Sucess√£o mais prov√°veis (TOP 3) foram:</div>`;
    
    let tableHTML = `<table class="analysis-table">
                       <thead><tr><th>Zona (Centro)</th><th>Vezes</th><th>Taxa de Assertividade</th></tr></thead>
                       <tbody>`;
    
    sortedFollowers.slice(0, 3).forEach(([centerNumStr, count]) => {
      const centerNum = Number(centerNumStr);
      const zone = getNeighbors(centerNum, 2);
      const percentage = ((count / followers.length) * 100).toFixed(1);
      
      tableHTML += `<tr>
                      <td>Zona **${centerNum}** (${zone.join(', ')})</td>
                      <td>${count}x</td>
                      <td><span style="color:var(--accent);">${percentage}%</span></td>
                    </tr>`;
    });
    
    tableHTML += `</tbody></table>`;
    zoneAnalysisDiv.innerHTML = html + tableHTML;
  }
  
  function renderBetSuggestion() {
      if (config.mode === 'DEMO' && config.bankrollState?.initial === 0) {
          betSuggestionDiv.innerHTML = `<span style="color:var(--muted)">Booster desativado no Modo DEMO. Alterne para REAL para sugest√µes de aposta.</span>`;
          return;
      }
      if (historyArr.length < 10) {
          betSuggestionDiv.innerHTML = `<span style="color:var(--muted)">Aguardando mais dados para ativar o Booster (m√≠nimo 10 lan√ßamentos)...</span>`;
          return;
      }
      
      const lastNum = historyArr[0];
      const lastZone = getNeighbors(lastNum, 2).sort().join(',');
      const followers = numberStats.zoneSuccessionMap[lastZone];
      
      if (!followers || followers.length < 5) {
          betSuggestionDiv.innerHTML = `<span style="color:var(--muted)">Aguardando mais recorr√™ncias da Zona de Ocorr√™ncia (${lastZone}) para sugerir com seguran√ßa.</span>`;
          return;
      }

      // C√°lculo do Booster
      const followerCounts = {};
      for (const num of followers) { followerCounts[num] = (followerCounts[num] || 0) + 1; }
      const sortedFollowers = Object.entries(followerCounts).sort((a, b) => b[1] - a[1]);
      
      const bestZoneCenter = Number(sortedFollowers[0][0]);
      const bestZoneCount = sortedFollowers[0][1];
      const bestZoneProbability = (bestZoneCount / followers.length) * 100;
      const bestZone = getNeighbors(bestZoneCenter, 2);

      // C√°lculo da Taxa de Ader√™ncia (Ader√™ncia da Roleta ao Padr√£o)
      // Verifica quantas vezes o padr√£o de sucess√£o mais prov√°vel se repetiu nos √∫ltimos 20 lan√ßamentos
      let adherenceCount = 0;
      const recentHistoryToCheck = historyArr.slice(0, 20); 
      for (let i = 0; i < recentHistoryToCheck.length - 1; i++) {
          const currentZoneCenter = recentHistoryToCheck[i];
          const nextNum = recentHistoryToCheck[i+1];
          const currentZone = getNeighbors(currentZoneCenter, 2).sort().join(',');
          
          if (numberStats.zoneSuccessionMap[currentZone]) {
              // Verifica se o n√∫mero que saiu (nextNum) est√° na ZONA de maior sucess√£o da ZONA atual.
              const historicalFollowers = numberStats.zoneSuccessionMap[currentZone];
              const historicalCounts = {};
              for (const num of historicalFollowers) { historicalCounts[num] = (historicalCounts[num] || 0) + 1; }
              const sortedHistorical = Object.entries(historicalCounts).sort((a, b) => b[1] - a[1]);
              
              if (sortedHistorical.length > 0) {
                  const historicalBestZoneCenter = Number(sortedHistorical[0][0]);
                  const historicalBestZone = getNeighbors(historicalBestZoneCenter, 2);
                  
                  if (historicalBestZone.includes(nextNum)) {
                      adherenceCount++;
                  }
              }
          }
      }
      const adherenceRate = (adherenceCount / (recentHistoryToCheck.length - 1)) * 100;
      
      let suggestionHTML = `
          <div style="font-size: 14px; margin-bottom: 8px; color: var(--muted);">
              √öltimo N√∫mero: <span style="color: var(--zero); font-weight: 700;">${lastNum}</span> (Zona de Ocorr√™ncia: ${getNeighbors(lastNum, 2).join(', ')})
          </div>
          <div style="margin-bottom: 12px;">
              üéØ **SUGEST√ÉO BOOSTER**: Aposte na **ZONA ${bestZoneCenter}** (${bestZone.join(', ')}).
          </div>
          <div style="font-family: 'Orbitron', sans-serif; font-size: 16px;">
              ‚ú® **Taxa de Assertividade de Aposta**: <span style="color: var(--alert-green);">${bestZoneProbability.toFixed(1)}%</span><br>
              üìà **Ader√™ncia ao Padr√£o da Roleta (Recente)**: <span style="color: var(--accent);">${adherenceRate.toFixed(1)}%</span>
          </div>
      `;
      
      betSuggestionDiv.innerHTML = suggestionHTML;
  }


  // Fun√ß√µes de renderiza√ß√£o que n√£o mudaram muito (History, HotCold, etc.)
  function renderHistory() { /* ... L√≥gica anterior ... */ }
  function renderHotCold() { /* ... L√≥gica anterior ... */ }
  function renderBankrollDashboard() { /* ... L√≥gica anterior ... */ }
  function renderBankrollHistory() { /* ... L√≥gica anterior ... */ }

  /* ================== INICIALIZA√á√ÉO E EVENTOS ================== */

  // 1. Popular Grid e Inicializa√ß√£o
  for (let i = 0; i <= 36; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    btn.className = 'number-btn ' + getColor(i);
    btn.onclick = () => addNumber(i);
    gridNumbers.appendChild(btn);
  }

  // 2. L√≥gica de Login/Sess√£o
  loadConfig();
  if (checkLockStatus()) {
      return; // Bloqueado, n√£o carrega o painel principal
  }
  
  if (getLoginStatus()) {
      loginScreen.classList.add('hidden');
      mainPanel.classList.remove('hidden');
      loadBankrollData();
      loadHistoryData(); 
      updateUI();
  } else {
      loginScreen.classList.remove('hidden');
      mainPanel.classList.add('hidden');
  }

  document.getElementById('btnSignInReal').onclick = () => {
      if (authPwdInput.value === getPasswordHash()) {
          setLoginStatus(true, 'REAL');
          location.reload(); // Recarrega para aplicar o modo
      } else {
          alert('Senha incorreta.');
      }
  };
  document.getElementById('btnSignInDemo').onclick = () => {
      if (authPwdInput.value === getPasswordHash()) {
          setLoginStatus(true, 'DEMO');
          location.reload(); // Recarrega para aplicar o modo
      } else {
          alert('Senha incorreta.');
      }
  };

  document.getElementById('logoutBtn').onclick = () => {
    if (confirm('Tem certeza que deseja sair?')) {
        setLoginStatus(false);
        config.isLocked = false;
        saveConfig();
        location.reload();
    }
  };
  
  // Fun√ß√µes de suporte (Clock, Clear, OCR)
  function updateClock(){ /* ... */ }
  // ... outras fun√ß√µes (OCR, clearBtn)

  // Iniciar rel√≥gio e outras l√≥gicas (necessita das fun√ß√µes de suporte originais do c√≥digo anterior)

  // Fun√ß√£o `renderHistory()` (implementa√ß√£o base do c√≥digo anterior)
  function renderHistory() {
    historyDiv.innerHTML = '';
    historyArr.forEach((n, i) => { 
      const chip = document.createElement('div');
      chip.textContent = n;
      chip.className = 'chip ' + getColor(n);
      const count = numberStats.counts[n]?.count || 0;
      if (numberStats.hotList.includes(n) && count >= HOT_THRESHOLD) chip.classList.add('hot');
      if (numberStats.coldList.includes(n) && count === 0) chip.classList.add('cold'); 
      chip.onclick = () => confirmRemoveNumber(i);
      historyDiv.appendChild(chip); 
    });
  }

  // Fun√ß√£o `renderHotCold()` (implementa√ß√£o base do c√≥digo anterior)
  function renderHotCold() {
    const hotNumbers = numberStats.hotList || [];
    const coldNumbers = numberStats.coldList || [];
    hotColdDiv.innerHTML = `üî• **Hot** (Mais Frequentes): ${hotNumbers.join(', ') || '-'}<br>‚ùÑÔ∏è **Cold** (Mais Atrasados): ${coldNumbers.join(', ') || '-'}`;
  }
  
  // Fun√ß√£o `renderBankrollDashboard()` (implementa√ß√£o base do c√≥digo anterior)
  function renderBankrollDashboard() {
    const { initial, current, history } = bankrollState;
    if (initial === 0) {
      document.getElementById('performanceDashboard').innerHTML = `<span class="stat-title" style="grid-column: 1 / -1;">Defina sua banca inicial para come√ßar.</span>`;
      return;
    }
    const totalProfit = parseFloat((current - initial).toFixed(2));
    const totalProfitPercent = (initial > 0) ? ((totalProfit / initial) * 100).toFixed(1) : 0;
    const wins = history.filter(v => v.amount > 0).length;
    const losses = history.filter(v => v.amount < 0).length;
    const totalBets = history.length;
    const winRate = (totalBets > 0) ? (wins / totalBets) * 100 : 0;
    const avgProfitPerBet = (totalBets > 0) ? (totalProfit / totalBets) : 0;
    const projection30Entries = (current + (avgProfitPerBet * 30));
    const suggestedBet = parseFloat((current * 0.02).toFixed(2));
    const profitClass = totalProfit > 0 ? 'positive' : totalProfit < 0 ? 'negative' : '';
    const projectionClass = projection30Entries > current ? 'positive' : projection30Entries < current ? 'negative' : '';

    document.getElementById('performanceDashboard').innerHTML = `
      <div class="stat-item">
        <div class="stat-title">BANCA ATUAL</div>
        <div class="stat-value">${formatCurrency(current)}</div>
      </div>
      <div class="stat-item ${profitClass}">
        <div class="stat-title">LUCRO/RED TOTAL</div>
        <div class="stat-value ${profitClass}">
          ${formatCurrency(totalProfit)} (${totalProfitPercent}%)
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-title">TAXA DE ACERTO</div>
        <div class="stat-value">${winRate.toFixed(1)}%</div>
      </div>
      <div class="stat-item">
        <div class="stat-title">ENTRADAS (W/L)</div>
        <div class="stat-value">
          <span class="positive">${wins}</span> / <span class="negative">${losses}</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-title">APOSTA SUGERIDA (2%)</div>
        <div class="stat-value">${formatCurrency(suggestedBet)}</div>
      </div>
      <div class="stat-item ${projectionClass}">
        <div class="stat-title">PROJE√á√ÉO (30 ENTRADAS)</div>
        <div class="stat-value ${projectionClass}">
          ${formatCurrency(projection30Entries)}
        </div>
      </div>
    `;
  }
  
  // Fun√ß√£o `renderBankrollHistory()` (implementa√ß√£o base do c√≥digo anterior)
  function renderBankrollHistory() {
    const history = bankrollState.history;
    if (history.length === 0) {
      bankrollHistoryDiv.innerHTML = `<div class="log-item log-placeholder">Nenhum registro ainda.</div>`;
      return;
    }
    bankrollHistoryDiv.innerHTML = '';
    [...history].reverse().forEach((entry, reverseIndex) => {
      const originalIndex = history.length - 1 - reverseIndex; 
      const amount = entry.amount;
      const item = document.createElement('div');
      item.className = 'log-item';
      const text = document.createElement('span');
      if (amount > 0) { item.classList.add('log-win'); text.textContent = `+ ${formatCurrency(amount)}`; } 
      else { item.classList.add('log-loss'); text.textContent = `${formatCurrency(amount)}`; }
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'log-delete-btn'; deleteBtn.textContent = 'X'; deleteBtn.title = 'Excluir este lan√ßamento';
      deleteBtn.onclick = () => deleteBankrollEntry(originalIndex);
      item.appendChild(text); item.appendChild(deleteBtn);
      bankrollHistoryDiv.appendChild(item);
    });
  }

  // Fun√ß√£o `deleteBankrollEntry()` (implementa√ß√£o base do c√≥digo anterior)
  function deleteBankrollEntry(indexToDelete) {
    const entry = bankrollState.history[indexToDelete];
    const amount = entry.amount;
    const entryType = amount > 0 ? 'Lucro' : 'Red';
    if (confirm(`Tem certeza que deseja excluir este lan√ßamento de ${entryType} (${formatCurrency(Math.abs(amount))})?`)) {
      bankrollState.history.splice(indexToDelete, 1);
      let newCurrent = bankrollState.initial * 100; 
      for (const item of bankrollState.history) { newCurrent += item.amount * 100; }
      bankrollState.current = newCurrent / 100; 
      saveBankrollData();
      checkStopCondition();
      updateUI();
    }
  }

  // Fun√ß√£o `confirmRemoveNumber()` (implementa√ß√£o base do c√≥digo anterior)
  function confirmRemoveNumber(index) {
    const num = historyArr[index];
    if (confirm(`Excluir o n√∫mero ${num} (mais recente) do hist√≥rico?`)) {
      historyArr.splice(index, 1);
      saveHistoryData();
      updateUI();
    }
  }

  // Fun√ß√£o `updateClock()` (implementa√ß√£o base do c√≥digo anterior)
  function updateClock(){
    const now = new Date();
    const h = String(now.getHours()).padStart(2,'0');
    const m = String(now.getMinutes()).padStart(2,'0');
    const s = String(now.getSeconds()).padStart(2,'0');
    document.getElementById('clock').textContent = `${h}:${m}:${s}`;
  }
  setInterval(updateClock, 1000);
  updateClock();
  
  // Fun√ß√£o `clearBtn` (implementa√ß√£o base do c√≥digo anterior)
  document.getElementById('clearBtn').onclick = () => {
    if (confirm('Tem certeza que deseja limpar TODO o hist√≥rico de lan√ßamentos da roleta?')) {
      historyArr = [];
      saveHistoryData();
      updateUI();
    }
  };
});
</script>

<script>
// Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker registrado com sucesso:', reg))
      .catch(err => console.log('Falha ao registrar Service Worker:', err));
  });
}
</script>

</body>
</html>
