<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ROLETA IAP BRASIL üáßüá∑ üìà</title>

<link rel="manifest" href="manifest.webmanifest">


<style>
/* ================== CONFIGURA√á√ïES GLOBAIS / FONT ================== */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;800&family=Roboto:wght@400;700&display=swap');

:root{
  --bg:#050512; 
  --panel:#0f1220; 
  --accent:#00fff6; /* Ciano Neon */
  --muted:#9aa0b8;
  --zero:#00ff6a; /* Verde Zero */
  --btn:linear-gradient(90deg,#2f3bff,#00fff6); 
  --hot:#ff3b57; 
  --cold:#4fa3ff;
  --win: #00ff6a; 
  --loss: #ff3b57;
  /* Novas Cores Brasil */
  --brasil-yellow: #ffc400; 
  --brasil-green: #00ff6a; 
}
*{box-sizing:border-box}
body{
  margin:0;
  /* Melhoria: Fontes misturadas - Orbitron para t√≠tulos, Roboto para corpo */
  font-family:'Roboto',sans-serif; 
  background:var(--bg);
  color:#e8f0ff;
  padding:14px;
}
.hidden { display: none !important; }

/* ================== LAYOUT E COMPONENTES B√ÅSICOS ================== */

/* Header / clock */
.header{
  background: linear-gradient(90deg, rgba(0,255,246,0.06), rgba(255,0,255,0.03)); 
  border-radius:12px; 
  padding:12px; 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  box-shadow:0 6px 30px rgba(0,255,246,0.04);
}
.title{
  font-family:'Orbitron',sans-serif;
  font-weight:800;
  font-size:18px;
  color: var(--accent);
}
#clock{
  color:var(--brasil-yellow); /* Destaque em Amarelo */
  font-family:'Orbitron',sans-serif;
  font-weight:700;
  animation:pulse 2s infinite alternate;
}
@keyframes pulse{
  0%{text-shadow:0 0 6px rgba(0,255,246,0.4)}
  100%{text-shadow:0 0 18px rgba(0,255,246,1)}
}

/* card */
.card{
  background:var(--panel);
  border-radius:12px;
  padding:12px;
  margin-top:12px;
  box-shadow:0 8px 40px rgba(0,0,0,0.4);
}

/* T√≠tulos / Sugest√µes */
.suggestionTitle{
  font-family:'Orbitron',sans-serif;
  font-weight:800;
  color:var(--brasil-green); /* T√≠tulos em Verde Brasil */
  margin-bottom:6px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.suggestionBox{
  font-size:14px;
  color:#dff;
  line-height:1.6;
}
.iaGlow{
  color:var(--accent);
  text-shadow:0 0 14px rgba(0,255,246,0.12);
  animation:pulse 2s infinite alternate
}
.data-separator {
  height: 2px;
  background: linear-gradient(90deg, var(--brasil-yellow), rgba(0,0,0,0));
  margin: 10px 0;
  opacity: 0.5;
}

/* ================== BOT√ïES E INPUTS ================== */

/* grid numbers */
.grid{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  justify-content:center;
  margin-top: 10px; /* Movido para c√° */
}
.number-btn{
  width:46px;height:46px;
  border-radius:50%;
  border:0;
  font-family:'Orbitron',sans-serif;
  font-weight:700;
  cursor:pointer;
  transition:transform .14s,box-shadow .14s;
}
.number-btn:hover{transform:scale(1.05)}
.red{background:#ff2746;color:#fff}
.black{background:#0c0c0e;color:#fff}
.zero, .green {background:var(--zero);color:#021} 

/* Bot√µes de controle */
.control-btn{
  background:var(--btn);
  border:0;
  border-radius:8px;
  padding:10px 14px;
  color:var(--bg); /* Cor de texto padr√£o dos bot√µes */
  font-weight:800;
  font-family:'Orbitron',sans-serif;
  cursor:pointer;
  transition: all .2s;
  margin: 4px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.control-btn:hover{opacity:0.9; box-shadow: 0 0 15px rgba(0,255,246,0.6);}
.control-btn:active{transform: translateY(1px);}

.btn-win { background: var(--win); color: #021; }
.btn-loss { background: var(--loss); color: #fff; }

/* history chips */
.history{
  display:flex;
  gap:8px;
  overflow-x:auto;
  white-space:nowrap;
  padding:10px 6px;
}
.chip{
  width:40px;height:40px;
  border-radius:50%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-family:'Orbitron',sans-serif;
  cursor:pointer;
  flex:0 0 auto; 
  transition: transform 0.15s, box-shadow 0.2s;
}
.chip:hover{transform: scale(1.1); box-shadow: 0 0 10px rgba(255,255,255,0.4);}
.chip.red{background:#ff2746;color:#fff}
.chip.black{background:#0c0c0e;color:#fff}
.chip.green{background:var(--zero);color:#021}
.chip.hot{box-shadow:0 0 16px var(--hot); border: 2px solid var(--hot);}
.chip.cold{box-shadow:0 0 16px var(--cold); border: 2px solid var(--cold);}

/* ================== TABELAS E DASHBOARD ================== */

.analysis-table{width:100%; border-collapse: collapse; margin-top: 8px;}
.analysis-table th, .analysis-table td{
  text-align:left; padding: 6px 4px; border-bottom: 1px solid rgba(0,255,246,0.1);
  font-size: 14px;
}
.analysis-table th{font-weight:700; color: var(--muted);}
.analysis-table td:nth-child(2){font-weight:700; color: #fff;}
.analysis-table td:nth-child(3){font-weight:700; color: var(--accent);}

/* Dashboard de Performance */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 14px;
  margin-top: 10px;
}
.stat-item {
  background: rgba(0,0,0,0.2);
  padding: 12px;
  border-radius: 8px;
  /* Melhoria: Borda de destaque na cor da performance */
  border-left: 4px solid var(--brasil-yellow); 
}
.stat-item.positive { border-left-color: var(--win); }
.stat-item.negative { border-left-color: var(--loss); }

.stat-title {
  font-size: 13px;
  color: var(--muted);
  font-weight: 400;
}
.stat-value {
  font-family:'Orbitron',sans-serif;
  font-size: 20px;
  font-weight: 800;
  margin-top: 4px;
}
.stat-value.positive { color: var(--win); }
.stat-value.negative { color: var(--loss); }


/* ================== GEST√ÉO DE BANCA ================== */
.bankroll-grid{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: flex-start;
  margin-top: 10px;
}
.bankroll-input{
  padding: 10px;
  border-radius: 8px;
  border: 1px solid var(--accent);
  background: rgba(0,0,0,0.2);
  color: #fff;
  font-family: 'Roboto', sans-serif;
  width: 100%;
  text-align: center;
  font-size: 16px;
}
.bankroll-actions .control-btn {
  width: 100%;
  margin: 4px 0;
}
.bankroll-label { 
  color: var(--muted); 
  font-size: 13px; 
  margin-bottom: 4px;
}

/* Extrato da Banca */
.bankroll-history-list {
  max-height: 150px; /* Aumentado o limite de altura */
  overflow-y: auto;
  background: rgba(0,0,0,0.2);
  border-radius: 8px;
  padding: 8px;
  margin-top: 10px;
  border: 1px solid rgba(0,255,246,0.1);
}
.log-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
  font-weight: 700;
  padding: 8px 4px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  font-family:'Orbitron',sans-serif;
}


/* ================== TELA DE LOGIN ================== */

#loginScreen{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  /* Fundo animado - Mais Brasil */
  background: linear-gradient(120deg, #050512 10%, #1a0830 30%, #00ff6a 50%, #ffc400 70%, #1a0830 90%, #050512 100%);
  background-size: 400% 400%;
  animation: cosmicFlow 25s ease infinite;
}

#loginBox{
  position:relative;
  z-index:2;
  background:rgba(6,8,16,0.95);
  padding:26px;
  border-radius:14px;
  box-shadow:0 12px 50px rgba(0,0,0,0.6);
  text-align:center;
  width:92%;
  max-width:420px;
  border: 2px solid var(--brasil-yellow);
}
.login-title{ 
  font-family:'Orbitron',sans-serif;
  font-size:24px;
  font-weight:800;
  color:var(--brasil-yellow); /* T√≠tulo Amarelo Brasil */
  margin-bottom:8px;
}
.login-subtitle{ 
  color:var(--muted);
  margin-bottom:10px;
}
#loginBox input{
  padding:10px;
  border-radius:8px;
  border:1px solid var(--accent);
  width:85%;
  margin-top:6px;
  font-weight:700;
  font-family:'Roboto',sans-serif; 
}
#loginBox button{
  margin-top:12px;
  padding:12px 20px;
  border-radius:8px;
  border:0;
  background:var(--btn);
  font-weight:800;
  font-size: 16px;
  cursor:pointer;
  font-family:'Orbitron',sans-serif; 
}

/* ================== RESPONSIVIDADE ================== */
@media (max-width:520px){
  .grid .number-btn{width:40px;height:40px}
  .chip{width:34px;height:34px}
  .bankroll-grid{ grid-template-columns: 1fr; }
}

/* Anima√ß√£o do fundo de login */
@keyframes cosmicFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>
</head>
<body>

<div id="loginScreen"> 
  <div id="loginBox">
    <div class="login-title">ROLETA IAP BRASIL üáßüá∑</div>
    <div class="login-subtitle">Acesso Exclusivo √† An√°lise Inteligente</div>

    <div id="signInForm">
      <input id="authPwd" type="password" placeholder="Senha de Acesso" autocomplete="current-password" required><br>
      <button id="btnSignIn">ENTRAR</button>
    </div>
    
  </div>
</div>

<div id="mainPanel" class="hidden">
  <div class="header">
    <div class="title">ROLETA IAP BRASIL üáßüá∑</div>
    <div id="clock">--:--:--</div>
  </div>

  <div class="card">
    <div class="suggestionTitle">üî¢ INSER√á√ÉO R√ÅPIDA DE RESULTADOS</div>
    <div class="grid" id="gridNumbers"></div>
    <div class="data-separator"></div>
    <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-top:12px;">
        <button id="btnUpload" class="control-btn" style="flex:1 1 150px;">üì∑ UPLOAD (OCR)</button> 
        <button id="clearBtn" class="control-btn btn-loss" title="Limpar hist√≥rico" style="flex:1 1 100px;">LIMPAR HIST√ìRICO</button>
        <button id="logoutBtn" class="control-btn control-logout" title="Sair" style="flex:1 1 100px;">SAIR</button>
    </div>
  </div>

  <div class="card">
    <div class="suggestionTitle">üí∏ GEST√ÉO DE BANCA E RISCO</div>
    <div id="performanceDashboard" class="dashboard-grid">
      <span class="stat-title" style="grid-column: 1 / -1;">Defina sua banca inicial para come√ßar.</span>
    </div>
    
    <div class="data-separator"></div>
    
    <div class="bankroll-grid">
        <div>
            <div class="bankroll-label">BANCA INICIAL (R$)</div>
            <input id="initialBankrollInput" type="number" class="bankroll-input" placeholder="1000" min="0" step="0.01">
            <button id="btnSetBankroll" class="control-btn" style="width: 100%; margin-top: 8px;">DEFINIR</button>
        </div>
        <div class="bankroll-actions">
            <div class="bankroll-label">REGISTRAR ENTRADA (R$)</div>
            <input id="betAmountInput" type="number" class="bankroll-input" placeholder="Valor ganho/perdido" min="0" step="0.01">
            <button id="btnRegisterWin" class="control-btn btn-win" style="margin-top: 8px;">LUCRAR (+)</button>
            <button id="btnRegisterLoss" class="control-btn btn-loss">RED (-)</button>
        </div>
    </div>
  </div>
  
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div class="history-title">HIST√ìRICO DA ROLETA <span id="historyCount" class="history-subtitle">0/100</span></div>
      <div class="history-subtitle">Recentes ‚Üí Antigos</div> 
    </div>
    <div id="history" class="history"></div>
    
    <div class="data-separator"></div>
    
    <div class="suggestionTitle">üßæ EXTRATO DE TRANSA√á√ïES</div>
    <div id="bankrollHistory" class="bankroll-history-list">
      <div class="log-item log-placeholder">Nenhum registro ainda.</div>
    </div>
  </div>

  <div class="card">
    <div class="suggestionTitle iaGlow">ü§ñ SUGEST√ÉO DE APOSTA I.A. (BOOSTER)</div>
    <div id="betSuggestion" class="suggestionBox" style="font-size: 16px; font-weight: 700;">
        <span style="color:var(--muted)">Aguardando mais dados para gerar uma sugest√£o...</span>
    </div>
  </div>
  
  <div class="card">
    <div class="analysis-wrapper">
      <div class="analysis-main">
        <div class="suggestionTitle">üöÄ AN√ÅLISE DE SUCESS√ÉO (AP√ìS O √öLTIMO)</div>
        <div id="lastNumberAnalysis" class="suggestionBox">Adicione n√∫meros ao hist√≥rico.</div>
      </div>
      <div class="analysis-hot-cold">
        <div class="suggestionTitle">üî• TEND√äNCIAS</div>
        <div id="hotCold" class="suggestionBox">üî• Hot: -<br>‚ùÑÔ∏è Cold: -</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="suggestionTitle">üìä ESTAT√çSTICAS GERAIS (PAR/√çMPAR/COR)</div>
    <div id="generalStats" class="suggestionBox">Adicione mais n√∫meros para ver os padr√µes.</div>
  </div>

  <input type="file" id="uploadPhoto" accept="image/*" class="hidden">
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ================== CONSTANTES DE ELEMENTOS ================== */
  const loginScreen = document.getElementById('loginScreen');
  const mainPanel = document.getElementById('mainPanel');
  
  const clockDiv = document.getElementById('clock');
  const gridNumbers = document.getElementById('gridNumbers');
  const historyDiv = document.getElementById('history');
  const historyCount = document.getElementById('historyCount');
  const lastNumberAnalysisDiv = document.getElementById('lastNumberAnalysis');
  const hotColdDiv = document.getElementById('hotCold');
  const generalStatsDiv = document.getElementById('generalStats');
  const betSuggestionDiv = document.getElementById('betSuggestion');
  const uploadInput = document.getElementById('uploadPhoto');
  const btnUpload = document.getElementById('btnUpload'); 
  
  const performanceDashboard = document.getElementById('performanceDashboard');
  const initialBankrollInput = document.getElementById('initialBankrollInput');
  const betAmountInput = document.getElementById('betAmountInput');
  const bankrollHistoryDiv = document.getElementById('bankrollHistory');
  const authPwdInput = document.getElementById('authPwd');
  
  // Constantes de Configura√ß√£o
  // Nova Senha: 2025
  const getPasswordHash = () => '2025'; 
  
  const BANKROLL_STORAGE_KEY = 'roletaIAPBankroll_main';
  const HISTORY_STORAGE_KEY = 'roletaIAPHistory'; 
  
  const RED_NUMBERS = new Set([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36]);
  
  /* ================== ESTADO DA APLICA√á√ÉO ================== */
  let historyArr = []; 
  let numberStats = {}; 
  
  let bankrollState = {
    initial: 0,
    current: 0,
    history: [] 
  };

  const MAX_HISTORY = 100;
  const HOT_THRESHOLD = 3; 

  /* ================== UTILIT√ÅRIOS ================== */
  const formatCurrency = (value) => value.toLocaleString('pt-BR', { 
    style: 'currency', 
    currency: 'BRL',
    minimumFractionDigits: 2, 
    maximumFractionDigits: 2 
  });
  
  function getColor(num) {
    if (num === 0) return 'green';
    if (RED_NUMBERS.has(num)) return 'red';
    return 'black';
  }

  /* ================== PERSIST√äNCIA E SESS√ÉO ================== */
  
  function saveBankrollData() {
    localStorage.setItem(BANKROLL_STORAGE_KEY, JSON.stringify(bankrollState));
  }
  
  function loadBankrollData() {
    const savedData = localStorage.getItem(BANKROLL_STORAGE_KEY);
    if (savedData) {
      bankrollState = JSON.parse(savedData);
      bankrollState.initial = bankrollState.initial || 0;
      bankrollState.current = bankrollState.current || 0;
      bankrollState.history = bankrollState.history || [];
    } else {
      bankrollState = { initial: 0, current: 0, history: [] };
    }
    initialBankrollInput.value = bankrollState.initial > 0 ? bankrollState.initial : '';
  }

  function saveHistoryData() {
    localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(historyArr));
  }
  
  function loadHistoryData() {
    const savedHistory = localStorage.getItem(HISTORY_STORAGE_KEY);
    if (savedHistory) {
      historyArr = JSON.parse(savedHistory).map(Number);
    } else {
      historyArr = [];
    }
  }
  
  // CORRE√á√ÉO: Usando localStorage para persistir a sess√£o de login
  function setLoginStatus(isLoggedIn) {
      if (isLoggedIn) {
          localStorage.setItem('isLoggedIn_roletaIAP', 'true');
      } else {
          localStorage.removeItem('isLoggedIn_roletaIAP');
      }
  }

  function getLoginStatus() {
      // Sess√£o salva no localStorage, n√£o expira por inatividade
      return localStorage.getItem('isLoggedIn_roletaIAP') === 'true'; 
  }

  /* ================== L√ìGICA DE GEST√ÉO DE BANCA ================== */
  
  document.getElementById('btnSetBankroll').onclick = () => {
    const initialRaw = parseFloat(initialBankrollInput.value);
    const initial = parseFloat(initialRaw.toFixed(2)); 

    if (isNaN(initial) || initial <= 0) {
      alert('Por favor, insira um valor de banca inicial v√°lido.');
      return;
    }
    
    if (bankrollState.initial > 0 && 
        !confirm('Ao redefinir a banca, o hist√≥rico de lucro/perda ser√° zerado. Continuar?')) {
        return;
    }

    bankrollState.initial = initial;
    bankrollState.current = initial;
    bankrollState.history = [];
    
    saveBankrollData();
    updateUI();
    alert(`Banca inicial definida em ${formatCurrency(initial)}`);
  };
  
  document.getElementById('btnRegisterWin').onclick = () => {
    const amountRaw = parseFloat(betAmountInput.value);
    const amount = parseFloat(amountRaw.toFixed(2));
    
    if (isNaN(amount) || amount <= 0) {
      alert('Por favor, insira um valor de lucro v√°lido.');
      return;
    }
    
    bankrollState.current = (bankrollState.current * 100 + amount * 100) / 100;
    bankrollState.history.push({ amount: amount, timestamp: Date.now() });
    
    saveBankrollData();
    updateUI();
    betAmountInput.value = '';
  };
  
  document.getElementById('btnRegisterLoss').onclick = () => {
    const amountRaw = parseFloat(betAmountInput.value);
    const amount = parseFloat(amountRaw.toFixed(2));
    
    if (isNaN(amount) || amount <= 0) {
      alert('Por favor, insira um valor de perda v√°lido.');
      return;
    }
    
    bankrollState.current = (bankrollState.current * 100 - amount * 100) / 100;
    bankrollState.history.push({ amount: -amount, timestamp: Date.now() });
    
    saveBankrollData();
    updateUI();
    betAmountInput.value = '';
  };
  
  function deleteBankrollEntry(indexToDelete) {
    const entry = bankrollState.history[indexToDelete];
    const amount = entry.amount;
    const entryType = amount > 0 ? 'Lucro' : 'Red';
    
    if (confirm(`Tem certeza que deseja excluir este lan√ßamento de ${entryType} (${formatCurrency(Math.abs(amount))})?`)) {
      
      bankrollState.history.splice(indexToDelete, 1);
      
      let newCurrent = bankrollState.initial * 100; 
      for (const item of bankrollState.history) {
        newCurrent += item.amount * 100;
      }
      bankrollState.current = newCurrent / 100; 
      
      saveBankrollData();
      updateUI();
    }
  }
  
  function renderBankrollDashboard() {
    const { initial, current, history } = bankrollState;
    
    if (initial === 0) {
      performanceDashboard.innerHTML = `<span class="stat-title" style="grid-column: 1 / -1;">Defina sua banca inicial para come√ßar.</span>`;
      return;
    }
    
    const totalProfit = parseFloat((current - initial).toFixed(2));
    const totalProfitPercent = (initial > 0) ? ((totalProfit / initial) * 100).toFixed(1) : 0;
    
    const wins = history.filter(v => v.amount > 0).length;
    const losses = history.filter(v => v.amount < 0).length;
    const totalBets = history.length;
    const winRate = (totalBets > 0) ? (wins / totalBets) * 100 : 0;
    
    const avgProfitPerBet = (totalBets > 0) ? (totalProfit / totalBets) : 0;
    const projection30Entries = (current + (avgProfitPerBet * 30));
    
    const suggestedBet = parseFloat((current * 0.02).toFixed(2));
    
    const profitClass = totalProfit > 0 ? 'positive' : totalProfit < 0 ? 'negative' : '';
    const projectionClass = projection30Entries > current ? 'positive' : projection30Entries < current ? 'negative' : '';

    performanceDashboard.innerHTML = `
      <div class="stat-item">
        <div class="stat-title">BANCA ATUAL</div>
        <div class="stat-value">${formatCurrency(current)}</div>
      </div>
      <div class="stat-item ${profitClass}">
        <div class="stat-title">LUCRO/RED TOTAL</div>
        <div class="stat-value ${profitClass}">
          ${formatCurrency(totalProfit)} (${totalProfitPercent}%)
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-title">TAXA DE ACERTO</div>
        <div class="stat-value">${winRate.toFixed(1)}%</div>
      </div>
      <div class="stat-item">
        <div class="stat-title">ENTRADAS (W/L)</div>
        <div class="stat-value">
          <span class="positive">${wins}</span> / <span class="negative">${losses}</span>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-title">APOSTA SUGERIDA (2%)</div>
        <div class="stat-value">${formatCurrency(suggestedBet)}</div>
      </div>
      <div class="stat-item ${projectionClass}">
        <div class="stat-title">PROJE√á√ÉO (30 ENTRADAS)</div>
        <div class="stat-value ${projectionClass}">
          ${formatCurrency(projection30Entries)}
        </div>
      </div>
    `;
  }
  
  function renderBankrollHistory() {
    const history = bankrollState.history;
    
    if (history.length === 0) {
      bankrollHistoryDiv.innerHTML = `<div class="log-item log-placeholder">Nenhum registro ainda.</div>`;
      return;
    }
    
    bankrollHistoryDiv.innerHTML = '';
    
    [...history].reverse().forEach((entry, reverseIndex) => {
      
      const originalIndex = history.length - 1 - reverseIndex; 
      const amount = entry.amount;
      
      const item = document.createElement('div');
      item.className = 'log-item';
      
      const text = document.createElement('span');
      if (amount > 0) {
        item.classList.add('log-win');
        text.textContent = `+ ${formatCurrency(amount)}`;
      } else {
        item.classList.add('log-loss');
        text.textContent = `${formatCurrency(amount)}`; 
      }
      
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'log-delete-btn';
      deleteBtn.textContent = 'X';
      deleteBtn.title = 'Excluir este lan√ßamento';
      deleteBtn.onclick = deleteBankrollEntry.bind(null, originalIndex);
      
      item.appendChild(text);
      item.appendChild(deleteBtn);
      bankrollHistoryDiv.appendChild(item);
    });
  }
  
  
  /* ================== L√ìGICA DE AN√ÅLISE DA ROLETA ================== */

  function calculateStats() {
    const allNumbers = [...Array(37).keys()]; 
    
    const stats = {
      counts: {},
      nextMap: {},
      hotList: [],
      coldList: [],
      colorCounts: { red: 0, black: 0, green: 0 },
      parityCounts: { even: 0, odd: 0 }
    };
    allNumbers.forEach(n => {
      stats.counts[n] = { count: 0 };
    });

    for (let i = historyArr.length - 1; i >= 0; i--) {
      const num = historyArr[i];
      
      stats.counts[num].count++;
      
      const color = getColor(num);
      stats.colorCounts[color]++;
      
      if (num !== 0) {
        num % 2 === 0 ? stats.parityCounts.even++ : stats.parityCounts.odd++;
      }
      
      if (i > 0) {
        const currentNum = historyArr[i]; 
        const nextNum = historyArr[i - 1]; 
        
        if (!stats.nextMap[currentNum]) {
          stats.nextMap[currentNum] = [];
        }
        stats.nextMap[currentNum].push(nextNum);
      }
    }

    stats.hotList = allNumbers
      .filter(n => stats.counts[n].count > 0)
      .sort((a, b) => stats.counts[b].count - stats.counts[a].count)
      .slice(0, 4);

    const allCounts = allNumbers.map(n => stats.counts[n].count);
    const minCount = allCounts.length > 0 ? Math.min(...allCounts) : 0;
    
    stats.coldList = allNumbers
      .filter(n => stats.counts[n].count === minCount) 
      .sort((a, b) => a - b) 
      .slice(0, 4);
    
    numberStats = stats;
  }
  
  function addNumber(num) {
    if (historyArr.length >= MAX_HISTORY) {
      historyArr.pop(); 
    }
    historyArr.unshift(num); 
    saveHistoryData();
    updateUI();
  }
  
  function addMultipleNumbers(numArray) {
    const numbersToAdd = numArray
      .map(n => parseInt(n, 10))
      .filter(n => !isNaN(n) && n >= 0 && n <= 36);
      
    if (numbersToAdd.length === 0) {
        alert('Nenhum n√∫mero de 0 a 36 identificado.');
        return;
    }
    
    historyArr = [...numbersToAdd, ...historyArr];
    
    if (historyArr.length > MAX_HISTORY) {
      historyArr = historyArr.slice(0, MAX_HISTORY);
    }
    
    saveHistoryData();
    updateUI();
    alert(`${numbersToAdd.length} n√∫meros adicionados automaticamente!`);
  }

  function removeNumber(index) {
    historyArr.splice(index, 1);
    saveHistoryData();
    updateUI();
  }
  
  function confirmRemoveNumber(index) {
    const num = historyArr[index];
    if (confirm(`Excluir o n√∫mero ${num} (mais recente) do hist√≥rico?`)) {
      removeNumber(index);
    }
  }

  /* ================== RENDERIZA√á√ÉO DA UI ================== */
  
  function updateUI() {
    if(mainPanel.classList.contains('hidden')) return; 
    
    calculateStats();
    renderHistory();
    renderHotCold();
    renderLastNumberAnalysis();
    renderGeneralStats();
    renderBetSuggestion();
    renderBankrollDashboard();
    renderBankrollHistory();
    
    historyCount.textContent = `${historyArr.length}/${MAX_HISTORY}`;
  }

  function renderHistory() {
    historyDiv.innerHTML = '';
    
    historyArr.forEach((n, i) => { 
      const chip = document.createElement('div');
      chip.textContent = n;
      chip.className = 'chip ' + getColor(n);
      
      const count = numberStats.counts[n]?.count || 0;
      
      if (numberStats.hotList.includes(n) && count >= HOT_THRESHOLD) chip.classList.add('hot');
      if (numberStats.coldList.includes(n) && count === 0) chip.classList.add('cold'); 
      
      chip.onclick = () => confirmRemoveNumber(i);
      
      historyDiv.appendChild(chip); 
    });
  }

  function renderHotCold() {
    const hotNumbers = numberStats.hotList || [];
    const coldNumbers = numberStats.coldList || [];
    hotColdDiv.innerHTML = `üî• **Hot** (Mais Frequentes): ${hotNumbers.join(', ') || '-'}<br>‚ùÑÔ∏è **Cold** (Mais Atrasados): ${coldNumbers.join(', ') || '-'}`;
  }
  
  function renderLastNumberAnalysis() {
    if (historyArr.length < 2) {
      lastNumberAnalysisDiv.innerHTML = 'Adicione n√∫meros ao hist√≥rico para ver a an√°lise de sucess√£o.';
      return;
    }
    
    const lastNum = historyArr[0];
    const followers = numberStats.nextMap[lastNum];
    const lastNumColor = getColor(lastNum);
    
    if (!followers || followers.length < 3) {
      lastNumberAnalysisDiv.innerHTML = `O √∫ltimo n√∫mero foi <b style="color:${lastNumColor === 'green' ? 'var(--zero)' : lastNumColor}">${lastNum}</b>. (Necess√°rio mais ocorr√™ncias para gerar dados de sucess√£o).`;
      return;
    }

    const followerCounts = {};
    for (const num of followers) {
      followerCounts[num] = (followerCounts[num] || 0) + 1;
    }
    
    const sortedFollowers = Object.entries(followerCounts)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5); 

    let tableHTML = `<div style="margin-bottom: 6px;">Ap√≥s o <b style="color:${lastNumColor === 'green' ? 'var(--zero)' : lastNumColor}">${lastNum}</b>, os TOP 5 sucessores foram:</div>
                     <table class="analysis-table">
                       <thead><tr><th>N√∫mero</th><th>Vezes</th><th>Chance</th></tr></thead>
                       <tbody>`;
    
    for (const [num, count] of sortedFollowers) {
      const percentage = ((count / followers.length) * 100).toFixed(1);
      const numColor = getColor(Number(num));
      tableHTML += `<tr>
                      <td><b style="color:${numColor === 'green' ? 'var(--zero)' : numColor}">${num}</b></td>
                      <td>${count}x</td>
                      <td>${percentage}%</td>
                    </tr>`;
    }
    
    tableHTML += `</tbody></table>`;
    lastNumberAnalysisDiv.innerHTML = tableHTML;
  }
  
  function renderBetSuggestion() {
      if (historyArr.length < 10) {
          betSuggestionDiv.innerHTML = `<span style="color:var(--muted)">Aguardando mais dados para ativar o Booster (m√≠nimo 10 lan√ßamentos)...</span>`;
          return;
      }

      let suggestion = "";
      const lastNum = historyArr[0];

      // 1. Padr√£o de Cor (3+ seguidos)
      const colorStreak = historyArr.slice(0, 3).map(getColor); 
      if (colorStreak.every(c => c === 'red') && colorStreak.length === 3) {
          suggestion = `üü¢ **BOOSTER ATIVADO**: Sa√≠ram **3 Vermelhos** seguidos. Aposta sugerida: **Preto** (Quebra de Padr√£o).`;
      } else if (colorStreak.every(c => c === 'black') && colorStreak.length === 3) {
          suggestion = `üî¥ **BOOSTER ATIVADO**: Sa√≠ram **3 Pretos** seguidos. Aposta sugerida: **Vermelho** (Quebra de Padr√£o).`;
      } 
      
      // 2. Mapeamento de Pr√≥ximo N√∫mero (Sucess√£o)
      else {
          const followers = numberStats.nextMap[lastNum];
          if (followers && followers.length >= 5) { 
              const followerCounts = {};
              for (const num of followers) {
                followerCounts[num] = (followerCounts[num] || 0) + 1;
              }
              const sortedFollowers = Object.entries(followerCounts).sort((a, b) => b[1] - a[1]);
              const mostFrequent = sortedFollowers[0];
              const mostFrequentNum = mostFrequent[0];
              const probability = (mostFrequent[1] / followers.length) * 100;

              if (probability >= 35) { 
                  suggestion = `üéØ **BOOSTER ATIVADO**: Ap√≥s o **${lastNum}**, o n√∫mero **${mostFrequentNum}** tem **${probability.toFixed(0)}%** de chance de sair (Sucess√£o Hist√≥rica).`;
              }
          }
      }
      
      // 3. Tend√™ncia Hot (Apenas se n√£o houver padr√£o de cor ou sucess√£o)
      if (!suggestion) {
          const hotList = numberStats.hotList;
          if (hotList.length > 0) {
              const hottestNum = hotList[0];
              const hottestCount = numberStats.counts[hottestNum].count;
              if (hottestCount >= 5) {
                  suggestion = `üìà **TEND√äNCIA**: O n√∫mero **${hottestNum}** est√° "quente" (saiu **${hottestCount}** vezes). Aposta sugerida: **${hottestNum}** (Seguir Fluxo).`;
              }
          }
      }

      if (!suggestion) {
        suggestion = 'Nenhum padr√£o forte detectado no momento. Jogue com cautela ou baseie-se nas estat√≠sticas gerais.';
        betSuggestionDiv.innerHTML = `<span style="color:var(--muted)">${suggestion}</span>`;
      } else {
        betSuggestionDiv.innerHTML = `<span class="iaGlow">${suggestion}</span>`;
      }
  }
  
  function renderGeneralStats() {
    if (historyArr.length < 10) {
      generalStatsDiv.innerHTML = 'Adicione mais n√∫meros para ver os padr√µes.';
      return;
    }
    
    const { colorCounts, parityCounts } = numberStats;
    const total = historyArr.length;
    
    const redPercent = (colorCounts.red / total) * 100;
    const blackPercent = (colorCounts.black / total) * 100;
    const greenPercent = (colorCounts.green / total) * 100;
    
    const totalParity = parityCounts.even + parityCounts.odd;
    const evenPercent = totalParity > 0 ? (parityCounts.even / totalParity) * 100 : 0;
    const oddPercent = totalParity > 0 ? (parityCounts.odd / totalParity) * 100 : 0;
    
    let html = `<div style="font-weight:700; margin-bottom: 8px;">An√°lise dos √∫ltimos ${total} lan√ßamentos:</div>`;
    html += `**Cores:** ${redPercent.toFixed(1)}% <span style="color:var(--hot)">Vermelho</span>, ${blackPercent.toFixed(1)}% Preto, ${greenPercent.toFixed(1)}% <span style="color:var(--zero)">Verde</span>.<br>`;
    html += `**Par/√çmpar:** ${evenPercent.toFixed(1)}% Par, ${oddPercent.toFixed(1)}% √çmpar.<br>`;
    
    let statSuggestion = "";
    
    // An√°lise de Desequil√≠brio (Buscando 60%+ de desequil√≠brio)
    if (redPercent > 60) {
      statSuggestion = `**ALERTA DE DESEQUIL√çBRIO**: O Vermelho est√° com ${redPercent.toFixed(0)}%. Forte chance de revers√£o para **PRETO**.`;
    } else if (blackPercent > 60) {
      statSuggestion = `**ALERTA DE DESEQUIL√çBRIO**: O Preto est√° com ${blackPercent.toFixed(0)}%. Forte chance de revers√£o para **VERMELHO**.`;
    }
    else if (evenPercent > 60) {
      statSuggestion = `**ALERTA DE DESEQUIL√çBRIO**: O Par est√° com ${evenPercent.toFixed(0)}%. Forte chance de revers√£o para **√çMPAR**.`;
    } else if (oddPercent > 60) {
      statSuggestion = `**ALERTA DE DESEQUIL√çBRIO**: O √çmpar est√° com ${oddPercent.toFixed(0)}%. Forte chance de revers√£o para **PAR**.`;
    }
    else {
      statSuggestion = "O hist√≥rico est√° equilibrado. Foco no Mapeamento de Sucess√£o ou Tend√™ncias HOT.";
    }
    
    html += `<br><div class="iaGlow" style="color:var(--accent); font-weight:700;">DICA ESTAT√çSTICA:</div> ${statSuggestion}`;
    
    generalStatsDiv.innerHTML = html;
  }

  /* ================== INICIALIZA√á√ÉO E EVENTOS ================== */

  // 1. Popular Grid
  for (let i = 0; i <= 36; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    btn.className = 'number-btn ' + getColor(i);
    btn.onclick = () => addNumber(i);
    gridNumbers.appendChild(btn);
  }

  // 2. Clock
  function updateClock(){
    const now = new Date();
    const h = String(now.getHours()).padStart(2,'0');
    const m = String(now.getMinutes()).padStart(2,'0');
    const s = String(now.getSeconds()).padStart(2,'0');
    clockDiv.textContent = `${h}:${m}:${s}`;
  }
  setInterval(updateClock, 1000);
  updateClock();
  
  // 3. L√≥gica de Login/Sess√£o (Usando localStorage para persistir a sess√£o)
  
  if (getLoginStatus()) {
      loginScreen.classList.add('hidden');
      mainPanel.classList.remove('hidden');
      loadBankrollData();
      loadHistoryData(); 
      updateUI();
  } else {
      loginScreen.classList.remove('hidden');
      mainPanel.classList.add('hidden');
  }

  function handleLoginEnter(event) {
    if (event.key === 'Enter' || event.keyCode === 13) {
      event.preventDefault(); 
      document.getElementById('btnSignIn').click();
    }
  }

  authPwdInput.addEventListener('keydown', handleLoginEnter);
  
  // Bot√£o ENTRAR
  document.getElementById('btnSignIn').onclick = () => {
    const passwordInput = authPwdInput.value;

    if (passwordInput === getPasswordHash()) {
        setLoginStatus(true); // Persiste o login
        loginScreen.classList.add('hidden');
        mainPanel.classList.remove('hidden');
        loadBankrollData();
        loadHistoryData(); 
        updateUI();
    } else {
        alert('Senha incorreta.');
    }
  };

  // Bot√£o SAIR
  document.getElementById('logoutBtn').onclick = () => {
    if (confirm('Tem certeza que deseja sair?')) {
        setLoginStatus(false); // Remove o login
        mainPanel.classList.add('hidden');
        loginScreen.classList.remove('hidden');
        authPwdInput.value = '';
    }
  };
  
  // 4. Controles
  document.getElementById('clearBtn').onclick = () => {
    if (confirm('Tem certeza que deseja limpar TODO o hist√≥rico de lan√ßamentos da roleta?')) {
      historyArr = [];
      saveHistoryData();
      updateUI();
    }
  };

  // 5. L√≥gica OCR Tesseract
  
  btnUpload.onclick = () => {
    uploadInput.value = null; 
    uploadInput.click();
  };

  function preprocessImage(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const image = new Image();
        image.onload = () => {
          const canvas = document.createElement('canvas');
          canvas.width = image.width;
          canvas.height = image.height;
          const ctx = canvas.getContext('2d');
          
          ctx.drawImage(image, 0, 0);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;
          const threshold = 128; 

          for (let i = 0; i < data.length; i += 4) {
            const luminance = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];
            const value = luminance > threshold ? 255 : 0;
            data[i] = value;
            data[i + 1] = value;
            data[i + 2] = value;
          }
          
          ctx.putImageData(imageData, 0, 0);
          canvas.toBlob((blob) => {
              if (blob) {
                  resolve(URL.createObjectURL(blob));
              } else {
                  reject(new Error('Falha ao criar Blob da imagem processada.'));
              }
          }, 'image/jpeg', 0.9);
        };
        image.onerror = (err) => reject(err);
        image.src = event.target.result;
      };
      reader.onerror = (err) => reject(err);
      reader.readAsDataURL(file);
    });
  }

  uploadInput.addEventListener('change', async (event) => {
    const file = event.target.files[0];
    if (!file) return;

    btnUpload.textContent = 'Processando...';
    try {
      console.log('Iniciando pr√©-processamento...');
      const processedImageURL = await preprocessImage(file);

      const { data: { text } } = await Tesseract.recognize(
        processedImageURL,
        'eng', 
        {
          logger: m => console.log(m.status === 'recognizing text' ? `OCR: ${(m.progress * 100).toFixed(0)}%` : m.status),
          tessedit_pageseg_mode: '6', 
          tessedit_char_whitelist: '0123456789' 
        }
      );
      
      console.log('OCR Text Original:', text);
      const matches = text.match(/\b(0|[1-9]|[12]\d|3[0-6])\b/g); 
      
      if (matches && matches.length > 0) {
        
        const numbersFromOCR = matches.map(Number); 
        
        // Mantido .reverse() assumindo que o OCR l√™ do mais antigo para o mais recente na imagem.
        addMultipleNumbers(numbersFromOCR.reverse()); 
        
      } else {
        alert('Nenhum n√∫mero de 0 a 36 foi identificado na imagem.');
      }
    } catch (err) {
      console.error(err);
      alert('Erro ao processar a imagem. Veja o console para detalhes.');
    } finally {
      btnUpload.textContent = 'üì∑ UPLOAD (OCR)';
    }
  });

});
</script>

<script>
// Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker registrado com sucesso:', reg))
      .catch(err => console.log('Falha ao registrar Service Worker:', err));
  });
}
</script>

</body>
</html>
